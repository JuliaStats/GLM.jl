rng=StableRNG(123)

x1 = rand(rng, 15)
x2 = ifelse.(randn(rng, 15).>0,1,0)

y = ifelse.(0.004 .- 0.01.*x1 .+ 1.5.*x2 .+ randn(rng, 15).>0, 1, 0)
w = rand(rng, 15)*6
w = floor.(w) .+ 1


df = DataFrame(y=y,x1=x1,x2=x2, w=w)

clotting = DataFrame(u = log.([5,10,15,20,30,40,60,80,100]),
                     lot1 = [118,58,42,35,27,25,21,19,18],
                     w = [1.5,2.0,1.1,4.5,2.4,3.5,5.6,5.4,6.7])

quine.aweights = log.(3 .+ 3 .*quine.Days)
quine.pweights = 1.0./(quine.aweights./sum(quine.aweights))
quine.fweights = floor.(quine.aweights)

dobson = DataFrame(Counts = [18.,17,15,20,10,20,25,13,12],
    Outcome = categorical(repeat(string.('A':'C'), outer = 3)),
    Treatment = categorical(repeat(string.('a':'c'), inner = 3)),
    w = [1,2,1,2,3,4,3,2,1]
    )


@testset "GLM: Binomial with LogitLink link - AnalyticWeights" begin
    model = glm(@formula(y ~ 1 + x1 + x2), df, Binomial(), LogitLink(), wts=df)
    @test deviance(model) ≈ 40.80540879298288
    @test loglikelihood(model) ≈ -20.402704396491437
    @test coef(model) ≈ 
    @test stderror(model) ≈ [1.3764416117357274, 2.1047035048697387, 2891.0832705575244]
    @test aic(model) ≈ 46.805408792982874
    @test bic(model) ≈ 48.929559396289505
    @test momentmatrix(model) ≈ [4.975291538563986e-9 9.006548481517277e-10 4.975291538563986e-9; 7.457508769849823e-9 2.7405594965454296e-9 7.457508769849823e-9; 2.285271769575856e-8 1.528980344883474e-8 2.285271769575856e-8; 2.2327974533715886e-9 9.540869852611076e-11 2.2327974533715886e-9; -3.9002435408230824 -1.7082714161861667 -0.0; 1.9456115337317996 0.9402948505761761 0.0; 3.250941922802209e-8 2.4836342240320546e-8 3.250941922802209e-8; 0.7662630435773894 0.7083972308412865 0.0; 2.0874526025016062 1.0751322798196368 0.0; 1.995938694540086e-8 9.880729193072285e-9 1.995938694540086e-8; 2.354909005285928 1.651591865013276 0.0; -1.2548308790461924 -0.8703121995275815 -0.0; -1.3365591258889113 -1.1711904042878245 -0.0; -0.6626026393385315 -0.6256422062487993 -0.0; 2.9653540079963233e-8 2.192027023041504e-8 2.9653540079963233e-8]
end

@testset "GLM: Binomial with LogitLink link - AnalyticWeights" begin
    model = glm(@formula(y ~ 1 + x1 + x2), df, Binomial(), LogitLink(), wts=df)
    @test deviance(model) ≈ 40.80540879298288
    @test loglikelihood(model) ≈ -20.402704396491437
    @test coef(model) ≈ 
    @test stderror(model) ≈ [1.3764416117357274, 2.1047035048697387, 2891.0832705575244]
    @test aic(model) ≈ 46.805408792982874
    @test bic(model) ≈ 48.929559396289505
    @test momentmatrix(model) ≈ [4.975291538563986e-9 9.006548481517277e-10 4.975291538563986e-9; 7.457508769849823e-9 2.7405594965454296e-9 7.457508769849823e-9; 2.285271769575856e-8 1.528980344883474e-8 2.285271769575856e-8; 2.2327974533715886e-9 9.540869852611076e-11 2.2327974533715886e-9; -3.9002435408230824 -1.7082714161861667 -0.0; 1.9456115337317996 0.9402948505761761 0.0; 3.250941922802209e-8 2.4836342240320546e-8 3.250941922802209e-8; 0.7662630435773894 0.7083972308412865 0.0; 2.0874526025016062 1.0751322798196368 0.0; 1.995938694540086e-8 9.880729193072285e-9 1.995938694540086e-8; 2.354909005285928 1.651591865013276 0.0; -1.2548308790461924 -0.8703121995275815 -0.0; -1.3365591258889113 -1.1711904042878245 -0.0; -0.6626026393385315 -0.6256422062487993 -0.0; 2.9653540079963233e-8 2.192027023041504e-8 2.9653540079963233e-8]
end

@testset "GLM: Binomial with ProbitLink link - AnalyticWeights" begin
    model = glm(@formula(y ~ 1 + x1 + x2), df, Binomial(), ProbitLink(), wts=df)
    @test deviance(model) ≈ 40.78137404276874
    @test loglikelihood(model) ≈ -20.39068702138437
    @test coef(model) ≈ 
    @test stderror(model) ≈ [0.8364009151837031, 1.2669759328012313, 383.275056480285]
    @test aic(model) ≈ 46.78137404276874
    @test bic(model) ≈ 48.90552464607537
    @test momentmatrix(model) ≈ [2.141319874423096e-10 3.876335911964382e-11 2.141319874423096e-10; 2.660620461776351e-9 9.777512703308697e-10 2.660620461776351e-9; 1.6837104388797515e-7 1.1265006647327841e-7 1.6837104388797515e-7; 1.775927884351608e-11 7.588640333961262e-13 1.775927884351608e-11; -6.32108519917438 -2.768578180312368 -0.0; 3.160081293711658 1.5272360984516953 0.0; 5.617843709811802e-7 4.291885008799245e-7 5.617843709811802e-7; 1.3247656634751994 1.2247234619826348 0.0; 3.3733372105472994 1.737420874337357 0.0; 2.719173690921834e-8 1.3461044140494708e-8 2.719173690921834e-8; 3.7980026833505782 2.6636911749202743 0.0; -2.0047842518828927 -1.390456850377069 -0.0; -2.2151750132435413 -1.9410976058418117 -0.0; -1.11514238917241 -1.0529389761258265 -0.0; 4.12161049030174e-7 3.046746374574499e-7 4.12161049030174e-7]
end

@testset "GLM: Binomial with CauchitLink link - AnalyticWeights" begin
    model = glm(@formula(y ~ 1 + x1 + x2), df, Binomial(), CauchitLink(), wts=df)
    @test deviance(model) ≈ 40.8975259939964
    @test loglikelihood(model) ≈ -20.4487629969982
    @test coef(model) ≈ 
    @test stderror(model) ≈ [1.3251544363304, 2.0816819672326212, 3.9763720496138e10]
    @test aic(model) ≈ 46.8975259939964
    @test bic(model) ≈ 49.021676597303035
    @test momentmatrix(model) ≈ [3.292881549556344e-15 5.960956677632797e-16 3.292881549556344e-15; 2.469661355441319e-15 9.075757186192704e-16 2.469661355441319e-15; 2.469661724388082e-15 1.6523479987683206e-15 2.469661724388082e-15; 2.469660974846597e-15 1.055300108189554e-16 2.469660974846597e-15; -4.288393332164326 -1.8782775162685588 -0.0; 2.090455393992148 1.010296458594581 0.0; 2.469661833186925e-15 1.8867567604535068e-15 2.469661833186925e-15; 0.6503620950105018 0.6012487630862063 0.0; 2.3400182402064034 1.205214979443208 0.0; 4.116102547017224e-15 2.0376424741524278e-15 4.116102547017224e-15; 2.8310688979703755 1.9855418407609555 0.0; -1.610846692068502 -1.117233844883936 -0.0; -1.3776439416401394 -1.2071919107215705 -0.0; -0.6350206613065066 -0.5995987700109224 -0.0; 2.469661799647931e-15 1.8256051007749665e-15 2.469661799647931e-15]
end

@testset "GLM: Binomial with CloglogLink link - AnalyticWeights" begin
    model = glm(@formula(y ~ 1 + x1 + x2), df, Binomial(), CloglogLink(), wts=df)
    @test deviance(model) ≈ 41.205557080153405
    @test loglikelihood(model) ≈ -20.602778540076702
    @test coef(model) ≈ 
    @test stderror(model) ≈ [0.973218567746775, 1.5788168207479476, 134.2308296148033]
    @test aic(model) ≈ 47.205557080153405
    @test bic(model) ≈ 49.329707683460036
    @test momentmatrix(model) ≈ [8.881784197001252e-16 1.6078297995730002e-16 8.881784197001252e-16; 6.661338147750942e-16 2.447974797472054e-16 6.661338147750942e-16; 3.3706748473230575e-8 2.2551784252367408e-8 3.3706748473230575e-8; 6.661338147750942e-16 2.8464274811830893e-17 6.661338147750942e-16; -6.002070351507831 -2.62885256064177 -0.0; 3.090828500347432 1.4937669069612967 0.0; 2.193326882864893e-6 1.6756441179599079e-6 2.193326882864893e-6; 0.8552543543316015 0.7906681933203132 0.0; 3.211027051982352 1.653823818956702 0.0; 1.0692624807746624e-12 5.293295349074617e-13 1.0692624807746624e-12; 3.040005920969103 2.1320777309844043 0.0; -1.607851182110078 -1.1151562510789412 -0.0; -1.7153341048186206 -1.503100614703514 -0.0; -0.8718601911242182 -0.8232272271960682 -0.0; 8.127843792739411e-7 6.008204479027258e-7 8.127843792739411e-7]
end

@testset "GLM: Gamma with InverseLink link - AnalyticWeights" begin
    model = glm(@formula(lot1 ~ 1 + u), clotting, Gamma(), InverseLink(), wts=clotting)
    @test deviance(model) ≈ 0.03933389380881642
    @test loglikelihood(model) ≈ -43.359078787690514
    @test coef(model) ≈ 
    @test stderror(model) ≈ [0.0009144223353860925, 0.0003450913537314497]
    @test aic(model) ≈ 92.71815757538103
    @test bic(model) ≈ 93.30983130738969
    @test momentmatrix(model) ≈ [1900.1063511093867 3058.103199132267; -1643.317155973023 -3783.877586404854; -420.13783432322964 -1137.7543467296691; -981.2887166533023 -2939.6782781526754; 313.30087123532877 1065.5981029180723; -186.60227446859759 -688.353296378139; 324.34628373045786 1327.9854430687467; 430.8197010892654 1887.863404915401; 262.77277766267576 1210.113361381432]
end

@testset "GLM: Gamma with IdentityLink link - AnalyticWeights" begin
    model = glm(@formula(lot1 ~ 1 + u), clotting, Gamma(), IdentityLink(), wts=clotting)
    @test deviance(model) ≈ 1.3435348802929383
    @test loglikelihood(model) ≈ -101.19916126647321
    @test coef(model) ≈ 
    @test stderror(model) ≈ [16.07962739541372, 3.766841480457265]
    @test aic(model) ≈ 208.39832253294642
    @test bic(model) ≈ 208.9899962649551
    @test momentmatrix(model) ≈ [0.26061914480947884 0.4194503323625281; 0.06148544891860896 0.14157547811603585; -0.019061929106842457 -0.051620660951180786; -0.1795782998461795 -0.5379685084791557; -0.1764962075232437 -0.6002984389013568; -0.2277661940139623 -0.8402020334398342; -0.3204523427685144 -1.3120423070655995; -0.054878647210950426 -0.2404796937532563; 0.6561290267416002 3.0215858321118008]
end

@testset "GLM: Gamma with LogLink link - AnalyticWeights" begin
    model = glm(@formula(lot1 ~ 1 + u), clotting, Gamma(), LogLink(), wts=clotting)
    @test deviance(model) ≈ 0.41206342934199663
    @test loglikelihood(model) ≈ -81.79777246247532
    @test coef(model) ≈ 
    @test stderror(model) ≈ [0.20287310816341905, 0.053062600599660774]
    @test aic(model) ≈ 169.59554492495064
    @test bic(model) ≈ 170.18721865695932
    @test momentmatrix(model) ≈ [14.39716447431257 23.171342336508012; 0.0374983950207553 0.0863432453859933; -2.5490869750808054 -6.903055495494598; -12.821435846444906 -38.40958915849704; -8.713283462827741 -29.635596899449876; -6.520303896525519 -24.05261507847203; -4.123729229896082 -16.88396834850135; 3.70269025008355 16.225287295813413; 16.590486289982852 76.40201283367323]
end

@testset "GLM: Gamma with InverseLink link - AnalyticWeights" begin
    model = glm(@formula(lot1 ~ 1 + u), clotting, Gamma(), InverseLink(), wts=clotting)
    @test deviance(model) ≈ 0.03933389380881642
    @test loglikelihood(model) ≈ -43.359078787690514
    @test coef(model) ≈ 
    @test stderror(model) ≈ [0.0009144223353860925, 0.0003450913537314497]
    @test aic(model) ≈ 92.71815757538103
    @test bic(model) ≈ 93.30983130738969
    @test momentmatrix(model) ≈ [1900.1063511093867 3058.103199132267; -1643.317155973023 -3783.877586404854; -420.13783432322964 -1137.7543467296691; -981.2887166533023 -2939.6782781526754; 313.30087123532877 1065.5981029180723; -186.60227446859759 -688.353296378139; 324.34628373045786 1327.9854430687467; 430.8197010892654 1887.863404915401; 262.77277766267576 1210.113361381432]
end

@testset "GLM: InverseGaussian with InverseSquareLink link - AnalyticWeights" begin
    model = glm(@formula(lot1 ~ 1 + u), clotting, InverseGaussian(), InverseSquareLink(), wts=clotting)
    @test deviance(model) ≈ 0.021377370485120707
    @test loglikelihood(model) ≈ -86.82546665077861
    @test coef(model) ≈ 
    @test stderror(model) ≈ [0.00016779409928094252, 9.025235597677238e-5]
    @test aic(model) ≈ 179.65093330155722
    @test bic(model) ≈ 180.2426070335659
    @test momentmatrix(model) ≈ [28815.030725087538 46376.00289690935; -21039.070620903 -48444.250382140235; -6195.618377983015 -16778.045594449453; -15686.073415243622 -46991.276375382586; -1716.0787284468345 -5836.722477919495; -2086.203482054124 -7695.75316205041; 3418.087237993986 13994.826896081435; 6065.271775021221 26578.18246467872; 8424.676595366931 38797.069483575455]
end

@testset "GLM:  with LogLink link - AnalyticWeights" begin
    model = glm(@formula(Days ~ Eth + Sex + Age + Lrn), quine, (), LogLink(), wts=quine)
    @test deviance(model) ≈ 624.7631999565588
    @test loglikelihood(model) ≈ -2004.5939464322778
    @test coef(model) ≈ 
    @test stderror(model) ≈ [0.1950707397084349, 0.13200639191036218, 0.1373161597645507, 0.2088476016141468, 0.20252412726336674, 0.21060778935484836, 0.16126722793064027]
    @test aic(model) ≈ 4023.1878928645556
    @test bic(model) ≈ 4044.073139216514
    @test momentmatrix(model) ≈ [-3.866780529709063 -0.0 -3.866780529709063 -0.0 -0.0 -0.0 -3.866780529709063; -4.370085797122667 -0.0 -4.370085797122667 -0.0 -0.0 -0.0 -4.370085797122667; -3.956562495375882 -0.0 -3.956562495375882 -0.0 -0.0 -0.0 -3.956562495375882; -4.102299119258251 -0.0 -4.102299119258251 -0.0 -0.0 -0.0 -0.0; -4.102299119258251 -0.0 -4.102299119258251 -0.0 -0.0 -0.0 -0.0; -2.8243330916399567 -0.0 -2.8243330916399567 -0.0 -0.0 -0.0 -0.0; -0.7247974261272416 -0.0 -0.7247974261272416 -0.0 -0.0 -0.0 -0.0; -0.0382123316932152 -0.0 -0.0382123316932152 -0.0 -0.0 -0.0 -0.0; -3.813241073891047 -0.0 -3.813241073891047 -3.813241073891047 -0.0 -0.0 -3.813241073891047; -3.813241073891047 -0.0 -3.813241073891047 -3.813241073891047 -0.0 -0.0 -3.813241073891047; -1.593192001014045 -0.0 -1.593192001014045 -1.593192001014045 -0.0 -0.0 -1.593192001014045; -2.7127578570401822 -0.0 -2.7127578570401822 -2.7127578570401822 -0.0 -0.0 -0.0; 0.14484002662039835 0.0 0.14484002662039835 0.14484002662039835 0.0 0.0 0.0; -4.754224412754331 -0.0 -4.754224412754331 -0.0 -4.754224412754331 -0.0 -4.754224412754331; -0.6279394841753847 -0.0 -0.6279394841753847 -0.0 -0.6279394841753847 -0.0 -0.6279394841753847; 5.160032033317412 0.0 5.160032033317412 0.0 5.160032033317412 0.0 5.160032033317412; 6.363463014626628 0.0 6.363463014626628 0.0 6.363463014626628 0.0 6.363463014626628; -2.991376095035898 -0.0 -2.991376095035898 -0.0 -2.991376095035898 -0.0 -0.0; -2.492994950052581 -0.0 -2.492994950052581 -0.0 -2.492994950052581 -0.0 -0.0; -2.492994950052581 -0.0 -2.492994950052581 -0.0 -2.492994950052581 -0.0 -0.0; -2.226530220466526 -0.0 -2.226530220466526 -0.0 -2.226530220466526 -0.0 -0.0; 5.713017320814697 0.0 5.713017320814697 0.0 5.713017320814697 0.0 0.0; 6.908456992944485 0.0 6.908456992944485 0.0 6.908456992944485 0.0 0.0; 8.12839634400043 0.0 8.12839634400043 0.0 8.12839634400043 0.0 0.0; -4.628254089687799 -0.0 -4.628254089687799 -0.0 -0.0 -4.628254089687799 -0.0; -2.183958840253964 -0.0 -2.183958840253964 -0.0 -0.0 -2.183958840253964 -0.0; -2.183958840253964 -0.0 -2.183958840253964 -0.0 -0.0 -2.183958840253964 -0.0; -0.9503472567532946 -0.0 -0.9503472567532946 -0.0 -0.0 -0.9503472567532946 -0.0; 0.6731546773300909 0.0 0.6731546773300909 0.0 0.0 0.6731546773300909 0.0; 1.2423198758199778 0.0 1.2423198758199778 0.0 0.0 1.2423198758199778 0.0; 1.8236065476231822 0.0 1.8236065476231822 0.0 0.0 1.8236065476231822 0.0; -4.171836641319677 -0.0 -0.0 -0.0 -0.0 -0.0 -4.171836641319677; -3.9882995353410657 -0.0 -0.0 -0.0 -0.0 -0.0 -0.0; -3.0399730926465205 -0.0 -0.0 -0.0 -0.0 -0.0 -0.0; 1.309672612863431 0.0 0.0 0.0 0.0 0.0 0.0; 10.661189363296968 0.0 0.0 0.0 0.0 0.0 0.0; -3.7634043246260425 -0.0 -0.0 -3.7634043246260425 -0.0 -0.0 -3.7634043246260425; -3.6605640772207546 -0.0 -0.0 -3.6605640772207546 -0.0 -0.0 -3.6605640772207546; -3.6605640772207546 -0.0 -0.0 -3.6605640772207546 -0.0 -0.0 -3.6605640772207546; -3.0720683496525485 -0.0 -0.0 -3.0720683496525485 -0.0 -0.0 -3.0720683496525485; -1.885334027349047 -0.0 -0.0 -1.885334027349047 -0.0 -0.0 -1.885334027349047; 2.106807550276347 0.0 0.0 2.106807550276347 0.0 0.0 2.106807550276347; 3.0150038937286183 0.0 0.0 3.0150038937286183 0.0 0.0 3.0150038937286183; 6.387064937752826 0.0 0.0 6.387064937752826 0.0 0.0 6.387064937752826; 17.72394862307137 0.0 0.0 17.72394862307137 0.0 0.0 17.72394862307137; 18.296957173355864 0.0 0.0 18.296957173355864 0.0 0.0 18.296957173355864; -3.0375213985118954 -0.0 -0.0 -3.0375213985118954 -0.0 -0.0 -0.0; -3.0375213985118954 -0.0 -0.0 -3.0375213985118954 -0.0 -0.0 -0.0; -0.8508688349707806 -0.0 -0.0 -0.8508688349707806 -0.0 -0.0 -0.0; 2.2977798382338515 0.0 0.0 2.2977798382338515 0.0 0.0 0.0; 3.4686807301080997 0.0 0.0 3.4686807301080997 0.0 0.0 0.0; -4.658715933989554 -0.0 -0.0 -0.0 -4.658715933989554 -0.0 -4.658715933989554; -4.187227633826471 -0.0 -0.0 -0.0 -4.187227633826471 -0.0 -4.187227633826471; -4.04126740785402 -0.0 -0.0 -0.0 -4.04126740785402 -0.0 -4.04126740785402; -2.940568463040927 -0.0 -0.0 -0.0 -2.940568463040927 -0.0 -2.940568463040927; 4.342318636532548 0.0 0.0 0.0 4.342318636532548 0.0 4.342318636532548; 4.653011109293142 0.0 0.0 0.0 4.653011109293142 0.0 4.653011109293142; 8.523536317826032 0.0 0.0 0.0 8.523536317826032 0.0 8.523536317826032; 15.787943104351504 0.0 0.0 0.0 15.787943104351504 0.0 15.787943104351504; -3.6818016272511183 -0.0 -0.0 -0.0 -3.6818016272511183 -0.0 -0.0; -2.057196136670586 -0.0 -0.0 -0.0 -0.0 -2.057196136670586 -0.0; -3.834339745304657 -0.0 -0.0 -0.0 -0.0 -3.834339745304657 -0.0; -4.1780090350069425 -0.0 -0.0 -0.0 -0.0 -4.1780090350069425 -0.0; -4.491340364181187 -0.0 -0.0 -0.0 -0.0 -4.491340364181187 -0.0; -4.3190736545666875 -0.0 -0.0 -0.0 -0.0 -4.3190736545666875 -0.0; -3.731819061288569 -0.0 -0.0 -0.0 -0.0 -3.731819061288569 -0.0; -2.238272513055515 -0.0 -0.0 -0.0 -0.0 -2.238272513055515 -0.0; 1.9859737921268132 0.0 0.0 0.0 0.0 1.9859737921268132 0.0; 3.2559592797891495 0.0 0.0 0.0 0.0 3.2559592797891495 0.0; -3.8426774654770597 -3.8426774654770597 -3.8426774654770597 -0.0 -0.0 -0.0 -3.8426774654770597; -0.9876822943882244 -0.9876822943882244 -0.9876822943882244 -0.0 -0.0 -0.0 -0.9876822943882244; 23.20842027925341 23.20842027925341 23.20842027925341 0.0 0.0 0.0 23.20842027925341; -1.920845416870046 -1.920845416870046 -1.920845416870046 -0.0 -0.0 -0.0 -0.0; -1.920845416870046 -1.920845416870046 -1.920845416870046 -0.0 -0.0 -0.0 -0.0; -3.2888901738202923 -3.2888901738202923 -3.2888901738202923 -0.0 -0.0 -0.0 -0.0; -2.758113321833414 -2.758113321833414 -2.758113321833414 -0.0 -0.0 -0.0 -0.0; -1.306843142455193 -1.306843142455193 -1.306843142455193 -0.0 -0.0 -0.0 -0.0; -0.8751747276035264 -0.8751747276035264 -0.8751747276035264 -0.0 -0.0 -0.0 -0.0; -1.8877508012966644 -1.8877508012966644 -1.8877508012966644 -1.8877508012966644 -0.0 -0.0 -1.8877508012966644; -1.8877508012966644 -1.8877508012966644 -1.8877508012966644 -1.8877508012966644 -0.0 -0.0 -1.8877508012966644; -2.9308943363443847 -2.9308943363443847 -2.9308943363443847 -2.9308943363443847 -0.0 -0.0 -2.9308943363443847; -2.9308943363443847 -2.9308943363443847 -2.9308943363443847 -2.9308943363443847 -0.0 -0.0 -2.9308943363443847; -2.9308943363443847 -2.9308943363443847 -2.9308943363443847 -2.9308943363443847 -0.0 -0.0 -2.9308943363443847; -0.6051770620747217 -0.6051770620747217 -0.6051770620747217 -0.6051770620747217 -0.0 -0.0 -0.6051770620747217; 2.697606708942873 2.697606708942873 2.697606708942873 2.697606708942873 0.0 0.0 2.697606708942873; -2.628558928820721 -2.628558928820721 -2.628558928820721 -2.628558928820721 -0.0 -0.0 -0.0; -2.3542975772061085 -2.3542975772061085 -2.3542975772061085 -2.3542975772061085 -0.0 -0.0 -0.0; 0.11268811798135936 0.11268811798135936 0.11268811798135936 0.0 0.11268811798135936 0.0 0.11268811798135936; 3.1826005245112854 3.1826005245112854 3.1826005245112854 0.0 3.1826005245112854 0.0 3.1826005245112854; 5.692953263520725 5.692953263520725 5.692953263520725 0.0 5.692953263520725 0.0 5.692953263520725; -2.7839804243079254 -2.7839804243079254 -2.7839804243079254 -0.0 -2.7839804243079254 -0.0 -0.0; -1.9433894208611948 -1.9433894208611948 -1.9433894208611948 -0.0 -1.9433894208611948 -0.0 -0.0; -2.962526696741388 -2.962526696741388 -2.962526696741388 -0.0 -2.962526696741388 -0.0 -0.0; -3.4432739212266052 -3.4432739212266052 -3.4432739212266052 -0.0 -3.4432739212266052 -0.0 -0.0; -3.0516553688541084 -3.0516553688541084 -3.0516553688541084 -0.0 -3.0516553688541084 -0.0 -0.0; 0.3128048727055356 0.3128048727055356 0.3128048727055356 0.0 0.3128048727055356 0.0 0.0; 5.983398649554576 5.983398649554576 5.983398649554576 0.0 5.983398649554576 0.0 0.0; -1.9961184031161041 -1.9961184031161041 -1.9961184031161041 -0.0 -0.0 -1.9961184031161041 -0.0; 4.212201806010905 4.212201806010905 4.212201806010905 0.0 0.0 4.212201806010905 0.0; -3.152192412974143 -3.152192412974143 -3.152192412974143 -0.0 -0.0 -3.152192412974143 -0.0; -2.03792823060008 -2.03792823060008 -2.03792823060008 -0.0 -0.0 -2.03792823060008 -0.0; 2.9007973162738843 2.9007973162738843 2.9007973162738843 0.0 0.0 2.9007973162738843 0.0; 9.364366020386104 9.364366020386104 9.364366020386104 0.0 0.0 9.364366020386104 0.0; 24.059031354439128 24.059031354439128 24.059031354439128 0.0 0.0 24.059031354439128 0.0; 2.864621620127876 2.864621620127876 0.0 0.0 0.0 0.0 2.864621620127876; -1.374372490365048 -1.374372490365048 -0.0 -0.0 -0.0 -0.0 -0.0; -0.9287032240778311 -0.9287032240778311 -0.0 -0.0 -0.0 -0.0 -0.0; 3.919550403175515 3.919550403175515 0.0 0.0 0.0 0.0 0.0; 12.426707944681816 12.426707944681816 0.0 0.0 0.0 0.0 0.0; -2.750339462985501 -2.750339462985501 -0.0 -2.750339462985501 -0.0 -0.0 -2.750339462985501; -2.0720837572297617 -2.0720837572297617 -0.0 -2.0720837572297617 -0.0 -0.0 -2.0720837572297617; -1.8681224147832116 -1.8681224147832116 -0.0 -1.8681224147832116 -0.0 -0.0 -1.8681224147832116; -2.778411659017331 -2.778411659017331 -0.0 -2.778411659017331 -0.0 -0.0 -2.778411659017331; -2.750339462985501 -2.750339462985501 -0.0 -2.750339462985501 -0.0 -0.0 -2.750339462985501; -2.750339462985501 -2.750339462985501 -0.0 -2.750339462985501 -0.0 -0.0 -2.750339462985501; -2.750339462985501 -2.750339462985501 -0.0 -2.750339462985501 -0.0 -0.0 -2.750339462985501; -2.750339462985501 -2.750339462985501 -0.0 -2.750339462985501 -0.0 -0.0 -2.750339462985501; -2.0720837572297617 -2.0720837572297617 -0.0 -2.0720837572297617 -0.0 -0.0 -2.0720837572297617; -0.18952790670731487 -0.18952790670731487 -0.0 -0.18952790670731487 -0.0 -0.0 -0.18952790670731487; 2.1145280030507307 2.1145280030507307 0.0 2.1145280030507307 0.0 0.0 2.1145280030507307; -1.7407825357737137 -1.7407825357737137 -0.0 -1.7407825357737137 -0.0 -0.0 -0.0; 4.548120970699322 4.548120970699322 0.0 4.548120970699322 0.0 0.0 0.0; -1.2257166987183963 -1.2257166987183963 -0.0 -1.2257166987183963 -0.0 -0.0 -0.0; -1.2257166987183963 -1.2257166987183963 -0.0 -1.2257166987183963 -0.0 -0.0 -0.0; -0.6449075179371568 -0.6449075179371568 -0.0 -0.6449075179371568 -0.0 -0.0 -0.0; 17.819813171012125 17.819813171012125 0.0 17.819813171012125 0.0 0.0 0.0; -1.999110422648601 -1.999110422648601 -0.0 -0.0 -1.999110422648601 -0.0 -1.999110422648601; -3.9564518053768536 -3.9564518053768536 -0.0 -0.0 -3.9564518053768536 -0.0 -3.9564518053768536; -2.1216196203872557 -2.1216196203872557 -0.0 -0.0 -2.1216196203872557 -0.0 -2.1216196203872557; -3.601990642806918 -3.601990642806918 -0.0 -0.0 -3.601990642806918 -0.0 -3.601990642806918; -3.601990642806918 -3.601990642806918 -0.0 -0.0 -3.601990642806918 -0.0 -3.601990642806918; -3.8495441274063715 -3.8495441274063715 -0.0 -0.0 -3.8495441274063715 -0.0 -3.8495441274063715; -3.6199500530041027 -3.6199500530041027 -0.0 -0.0 -3.6199500530041027 -0.0 -3.6199500530041027; -3.209822061567088 -3.209822061567088 -0.0 -0.0 -3.209822061567088 -0.0 -3.209822061567088; -2.702521155801149 -2.702521155801149 -0.0 -0.0 -2.702521155801149 -0.0 -2.702521155801149; -2.921923505820458 -2.921923505820458 -0.0 -0.0 -2.921923505820458 -0.0 -0.0; -3.058405902935942 -3.058405902935942 -0.0 -0.0 -0.0 -3.058405902935942 -0.0; -3.1473667781351766 -3.1473667781351766 -0.0 -0.0 -0.0 -3.1473667781351766 -0.0; 1.4593378269316923 1.4593378269316923 0.0 0.0 0.0 1.4593378269316923 0.0; -3.7560337640183694 -3.7560337640183694 -0.0 -0.0 -0.0 -3.7560337640183694 -0.0; -3.7560337640183694 -3.7560337640183694 -0.0 -0.0 -0.0 -3.7560337640183694 -0.0; -3.8041614268127484 -3.8041614268127484 -0.0 -0.0 -0.0 -3.8041614268127484 -0.0; -1.3131162740760067 -1.3131162740760067 -0.0 -0.0 -0.0 -1.3131162740760067 -0.0; -0.18645252170591944 -0.18645252170591944 -0.0 -0.0 -0.0 -0.18645252170591944 -0.0; 1.4593378269316923 1.4593378269316923 0.0 0.0 0.0 1.4593378269316923 0.0; 8.572921389223637 8.572921389223637 0.0 0.0 0.0 8.572921389223637 0.0]
end

@testset "GLM:  with LogLink link - AnalyticWeights" begin
    model = glm(@formula(Days ~ Eth + Sex + Age + Lrn), quine, (), LogLink(), wts=quine)
    @test deviance(model) ≈ 624.7631999565588
    @test loglikelihood(model) ≈ -2004.5939464322778
    @test coef(model) ≈ 
    @test stderror(model) ≈ [0.1950707397084349, 0.13200639191036218, 0.1373161597645507, 0.2088476016141468, 0.20252412726336674, 0.21060778935484836, 0.16126722793064027]
    @test aic(model) ≈ 4023.1878928645556
    @test bic(model) ≈ 4044.073139216514
    @test momentmatrix(model) ≈ [-3.866780529709063 -0.0 -3.866780529709063 -0.0 -0.0 -0.0 -3.866780529709063; -4.370085797122667 -0.0 -4.370085797122667 -0.0 -0.0 -0.0 -4.370085797122667; -3.956562495375882 -0.0 -3.956562495375882 -0.0 -0.0 -0.0 -3.956562495375882; -4.102299119258251 -0.0 -4.102299119258251 -0.0 -0.0 -0.0 -0.0; -4.102299119258251 -0.0 -4.102299119258251 -0.0 -0.0 -0.0 -0.0; -2.8243330916399567 -0.0 -2.8243330916399567 -0.0 -0.0 -0.0 -0.0; -0.7247974261272416 -0.0 -0.7247974261272416 -0.0 -0.0 -0.0 -0.0; -0.0382123316932152 -0.0 -0.0382123316932152 -0.0 -0.0 -0.0 -0.0; -3.813241073891047 -0.0 -3.813241073891047 -3.813241073891047 -0.0 -0.0 -3.813241073891047; -3.813241073891047 -0.0 -3.813241073891047 -3.813241073891047 -0.0 -0.0 -3.813241073891047; -1.593192001014045 -0.0 -1.593192001014045 -1.593192001014045 -0.0 -0.0 -1.593192001014045; -2.7127578570401822 -0.0 -2.7127578570401822 -2.7127578570401822 -0.0 -0.0 -0.0; 0.14484002662039835 0.0 0.14484002662039835 0.14484002662039835 0.0 0.0 0.0; -4.754224412754331 -0.0 -4.754224412754331 -0.0 -4.754224412754331 -0.0 -4.754224412754331; -0.6279394841753847 -0.0 -0.6279394841753847 -0.0 -0.6279394841753847 -0.0 -0.6279394841753847; 5.160032033317412 0.0 5.160032033317412 0.0 5.160032033317412 0.0 5.160032033317412; 6.363463014626628 0.0 6.363463014626628 0.0 6.363463014626628 0.0 6.363463014626628; -2.991376095035898 -0.0 -2.991376095035898 -0.0 -2.991376095035898 -0.0 -0.0; -2.492994950052581 -0.0 -2.492994950052581 -0.0 -2.492994950052581 -0.0 -0.0; -2.492994950052581 -0.0 -2.492994950052581 -0.0 -2.492994950052581 -0.0 -0.0; -2.226530220466526 -0.0 -2.226530220466526 -0.0 -2.226530220466526 -0.0 -0.0; 5.713017320814697 0.0 5.713017320814697 0.0 5.713017320814697 0.0 0.0; 6.908456992944485 0.0 6.908456992944485 0.0 6.908456992944485 0.0 0.0; 8.12839634400043 0.0 8.12839634400043 0.0 8.12839634400043 0.0 0.0; -4.628254089687799 -0.0 -4.628254089687799 -0.0 -0.0 -4.628254089687799 -0.0; -2.183958840253964 -0.0 -2.183958840253964 -0.0 -0.0 -2.183958840253964 -0.0; -2.183958840253964 -0.0 -2.183958840253964 -0.0 -0.0 -2.183958840253964 -0.0; -0.9503472567532946 -0.0 -0.9503472567532946 -0.0 -0.0 -0.9503472567532946 -0.0; 0.6731546773300909 0.0 0.6731546773300909 0.0 0.0 0.6731546773300909 0.0; 1.2423198758199778 0.0 1.2423198758199778 0.0 0.0 1.2423198758199778 0.0; 1.8236065476231822 0.0 1.8236065476231822 0.0 0.0 1.8236065476231822 0.0; -4.171836641319677 -0.0 -0.0 -0.0 -0.0 -0.0 -4.171836641319677; -3.9882995353410657 -0.0 -0.0 -0.0 -0.0 -0.0 -0.0; -3.0399730926465205 -0.0 -0.0 -0.0 -0.0 -0.0 -0.0; 1.309672612863431 0.0 0.0 0.0 0.0 0.0 0.0; 10.661189363296968 0.0 0.0 0.0 0.0 0.0 0.0; -3.7634043246260425 -0.0 -0.0 -3.7634043246260425 -0.0 -0.0 -3.7634043246260425; -3.6605640772207546 -0.0 -0.0 -3.6605640772207546 -0.0 -0.0 -3.6605640772207546; -3.6605640772207546 -0.0 -0.0 -3.6605640772207546 -0.0 -0.0 -3.6605640772207546; -3.0720683496525485 -0.0 -0.0 -3.0720683496525485 -0.0 -0.0 -3.0720683496525485; -1.885334027349047 -0.0 -0.0 -1.885334027349047 -0.0 -0.0 -1.885334027349047; 2.106807550276347 0.0 0.0 2.106807550276347 0.0 0.0 2.106807550276347; 3.0150038937286183 0.0 0.0 3.0150038937286183 0.0 0.0 3.0150038937286183; 6.387064937752826 0.0 0.0 6.387064937752826 0.0 0.0 6.387064937752826; 17.72394862307137 0.0 0.0 17.72394862307137 0.0 0.0 17.72394862307137; 18.296957173355864 0.0 0.0 18.296957173355864 0.0 0.0 18.296957173355864; -3.0375213985118954 -0.0 -0.0 -3.0375213985118954 -0.0 -0.0 -0.0; -3.0375213985118954 -0.0 -0.0 -3.0375213985118954 -0.0 -0.0 -0.0; -0.8508688349707806 -0.0 -0.0 -0.8508688349707806 -0.0 -0.0 -0.0; 2.2977798382338515 0.0 0.0 2.2977798382338515 0.0 0.0 0.0; 3.4686807301080997 0.0 0.0 3.4686807301080997 0.0 0.0 0.0; -4.658715933989554 -0.0 -0.0 -0.0 -4.658715933989554 -0.0 -4.658715933989554; -4.187227633826471 -0.0 -0.0 -0.0 -4.187227633826471 -0.0 -4.187227633826471; -4.04126740785402 -0.0 -0.0 -0.0 -4.04126740785402 -0.0 -4.04126740785402; -2.940568463040927 -0.0 -0.0 -0.0 -2.940568463040927 -0.0 -2.940568463040927; 4.342318636532548 0.0 0.0 0.0 4.342318636532548 0.0 4.342318636532548; 4.653011109293142 0.0 0.0 0.0 4.653011109293142 0.0 4.653011109293142; 8.523536317826032 0.0 0.0 0.0 8.523536317826032 0.0 8.523536317826032; 15.787943104351504 0.0 0.0 0.0 15.787943104351504 0.0 15.787943104351504; -3.6818016272511183 -0.0 -0.0 -0.0 -3.6818016272511183 -0.0 -0.0; -2.057196136670586 -0.0 -0.0 -0.0 -0.0 -2.057196136670586 -0.0; -3.834339745304657 -0.0 -0.0 -0.0 -0.0 -3.834339745304657 -0.0; -4.1780090350069425 -0.0 -0.0 -0.0 -0.0 -4.1780090350069425 -0.0; -4.491340364181187 -0.0 -0.0 -0.0 -0.0 -4.491340364181187 -0.0; -4.3190736545666875 -0.0 -0.0 -0.0 -0.0 -4.3190736545666875 -0.0; -3.731819061288569 -0.0 -0.0 -0.0 -0.0 -3.731819061288569 -0.0; -2.238272513055515 -0.0 -0.0 -0.0 -0.0 -2.238272513055515 -0.0; 1.9859737921268132 0.0 0.0 0.0 0.0 1.9859737921268132 0.0; 3.2559592797891495 0.0 0.0 0.0 0.0 3.2559592797891495 0.0; -3.8426774654770597 -3.8426774654770597 -3.8426774654770597 -0.0 -0.0 -0.0 -3.8426774654770597; -0.9876822943882244 -0.9876822943882244 -0.9876822943882244 -0.0 -0.0 -0.0 -0.9876822943882244; 23.20842027925341 23.20842027925341 23.20842027925341 0.0 0.0 0.0 23.20842027925341; -1.920845416870046 -1.920845416870046 -1.920845416870046 -0.0 -0.0 -0.0 -0.0; -1.920845416870046 -1.920845416870046 -1.920845416870046 -0.0 -0.0 -0.0 -0.0; -3.2888901738202923 -3.2888901738202923 -3.2888901738202923 -0.0 -0.0 -0.0 -0.0; -2.758113321833414 -2.758113321833414 -2.758113321833414 -0.0 -0.0 -0.0 -0.0; -1.306843142455193 -1.306843142455193 -1.306843142455193 -0.0 -0.0 -0.0 -0.0; -0.8751747276035264 -0.8751747276035264 -0.8751747276035264 -0.0 -0.0 -0.0 -0.0; -1.8877508012966644 -1.8877508012966644 -1.8877508012966644 -1.8877508012966644 -0.0 -0.0 -1.8877508012966644; -1.8877508012966644 -1.8877508012966644 -1.8877508012966644 -1.8877508012966644 -0.0 -0.0 -1.8877508012966644; -2.9308943363443847 -2.9308943363443847 -2.9308943363443847 -2.9308943363443847 -0.0 -0.0 -2.9308943363443847; -2.9308943363443847 -2.9308943363443847 -2.9308943363443847 -2.9308943363443847 -0.0 -0.0 -2.9308943363443847; -2.9308943363443847 -2.9308943363443847 -2.9308943363443847 -2.9308943363443847 -0.0 -0.0 -2.9308943363443847; -0.6051770620747217 -0.6051770620747217 -0.6051770620747217 -0.6051770620747217 -0.0 -0.0 -0.6051770620747217; 2.697606708942873 2.697606708942873 2.697606708942873 2.697606708942873 0.0 0.0 2.697606708942873; -2.628558928820721 -2.628558928820721 -2.628558928820721 -2.628558928820721 -0.0 -0.0 -0.0; -2.3542975772061085 -2.3542975772061085 -2.3542975772061085 -2.3542975772061085 -0.0 -0.0 -0.0; 0.11268811798135936 0.11268811798135936 0.11268811798135936 0.0 0.11268811798135936 0.0 0.11268811798135936; 3.1826005245112854 3.1826005245112854 3.1826005245112854 0.0 3.1826005245112854 0.0 3.1826005245112854; 5.692953263520725 5.692953263520725 5.692953263520725 0.0 5.692953263520725 0.0 5.692953263520725; -2.7839804243079254 -2.7839804243079254 -2.7839804243079254 -0.0 -2.7839804243079254 -0.0 -0.0; -1.9433894208611948 -1.9433894208611948 -1.9433894208611948 -0.0 -1.9433894208611948 -0.0 -0.0; -2.962526696741388 -2.962526696741388 -2.962526696741388 -0.0 -2.962526696741388 -0.0 -0.0; -3.4432739212266052 -3.4432739212266052 -3.4432739212266052 -0.0 -3.4432739212266052 -0.0 -0.0; -3.0516553688541084 -3.0516553688541084 -3.0516553688541084 -0.0 -3.0516553688541084 -0.0 -0.0; 0.3128048727055356 0.3128048727055356 0.3128048727055356 0.0 0.3128048727055356 0.0 0.0; 5.983398649554576 5.983398649554576 5.983398649554576 0.0 5.983398649554576 0.0 0.0; -1.9961184031161041 -1.9961184031161041 -1.9961184031161041 -0.0 -0.0 -1.9961184031161041 -0.0; 4.212201806010905 4.212201806010905 4.212201806010905 0.0 0.0 4.212201806010905 0.0; -3.152192412974143 -3.152192412974143 -3.152192412974143 -0.0 -0.0 -3.152192412974143 -0.0; -2.03792823060008 -2.03792823060008 -2.03792823060008 -0.0 -0.0 -2.03792823060008 -0.0; 2.9007973162738843 2.9007973162738843 2.9007973162738843 0.0 0.0 2.9007973162738843 0.0; 9.364366020386104 9.364366020386104 9.364366020386104 0.0 0.0 9.364366020386104 0.0; 24.059031354439128 24.059031354439128 24.059031354439128 0.0 0.0 24.059031354439128 0.0; 2.864621620127876 2.864621620127876 0.0 0.0 0.0 0.0 2.864621620127876; -1.374372490365048 -1.374372490365048 -0.0 -0.0 -0.0 -0.0 -0.0; -0.9287032240778311 -0.9287032240778311 -0.0 -0.0 -0.0 -0.0 -0.0; 3.919550403175515 3.919550403175515 0.0 0.0 0.0 0.0 0.0; 12.426707944681816 12.426707944681816 0.0 0.0 0.0 0.0 0.0; -2.750339462985501 -2.750339462985501 -0.0 -2.750339462985501 -0.0 -0.0 -2.750339462985501; -2.0720837572297617 -2.0720837572297617 -0.0 -2.0720837572297617 -0.0 -0.0 -2.0720837572297617; -1.8681224147832116 -1.8681224147832116 -0.0 -1.8681224147832116 -0.0 -0.0 -1.8681224147832116; -2.778411659017331 -2.778411659017331 -0.0 -2.778411659017331 -0.0 -0.0 -2.778411659017331; -2.750339462985501 -2.750339462985501 -0.0 -2.750339462985501 -0.0 -0.0 -2.750339462985501; -2.750339462985501 -2.750339462985501 -0.0 -2.750339462985501 -0.0 -0.0 -2.750339462985501; -2.750339462985501 -2.750339462985501 -0.0 -2.750339462985501 -0.0 -0.0 -2.750339462985501; -2.750339462985501 -2.750339462985501 -0.0 -2.750339462985501 -0.0 -0.0 -2.750339462985501; -2.0720837572297617 -2.0720837572297617 -0.0 -2.0720837572297617 -0.0 -0.0 -2.0720837572297617; -0.18952790670731487 -0.18952790670731487 -0.0 -0.18952790670731487 -0.0 -0.0 -0.18952790670731487; 2.1145280030507307 2.1145280030507307 0.0 2.1145280030507307 0.0 0.0 2.1145280030507307; -1.7407825357737137 -1.7407825357737137 -0.0 -1.7407825357737137 -0.0 -0.0 -0.0; 4.548120970699322 4.548120970699322 0.0 4.548120970699322 0.0 0.0 0.0; -1.2257166987183963 -1.2257166987183963 -0.0 -1.2257166987183963 -0.0 -0.0 -0.0; -1.2257166987183963 -1.2257166987183963 -0.0 -1.2257166987183963 -0.0 -0.0 -0.0; -0.6449075179371568 -0.6449075179371568 -0.0 -0.6449075179371568 -0.0 -0.0 -0.0; 17.819813171012125 17.819813171012125 0.0 17.819813171012125 0.0 0.0 0.0; -1.999110422648601 -1.999110422648601 -0.0 -0.0 -1.999110422648601 -0.0 -1.999110422648601; -3.9564518053768536 -3.9564518053768536 -0.0 -0.0 -3.9564518053768536 -0.0 -3.9564518053768536; -2.1216196203872557 -2.1216196203872557 -0.0 -0.0 -2.1216196203872557 -0.0 -2.1216196203872557; -3.601990642806918 -3.601990642806918 -0.0 -0.0 -3.601990642806918 -0.0 -3.601990642806918; -3.601990642806918 -3.601990642806918 -0.0 -0.0 -3.601990642806918 -0.0 -3.601990642806918; -3.8495441274063715 -3.8495441274063715 -0.0 -0.0 -3.8495441274063715 -0.0 -3.8495441274063715; -3.6199500530041027 -3.6199500530041027 -0.0 -0.0 -3.6199500530041027 -0.0 -3.6199500530041027; -3.209822061567088 -3.209822061567088 -0.0 -0.0 -3.209822061567088 -0.0 -3.209822061567088; -2.702521155801149 -2.702521155801149 -0.0 -0.0 -2.702521155801149 -0.0 -2.702521155801149; -2.921923505820458 -2.921923505820458 -0.0 -0.0 -2.921923505820458 -0.0 -0.0; -3.058405902935942 -3.058405902935942 -0.0 -0.0 -0.0 -3.058405902935942 -0.0; -3.1473667781351766 -3.1473667781351766 -0.0 -0.0 -0.0 -3.1473667781351766 -0.0; 1.4593378269316923 1.4593378269316923 0.0 0.0 0.0 1.4593378269316923 0.0; -3.7560337640183694 -3.7560337640183694 -0.0 -0.0 -0.0 -3.7560337640183694 -0.0; -3.7560337640183694 -3.7560337640183694 -0.0 -0.0 -0.0 -3.7560337640183694 -0.0; -3.8041614268127484 -3.8041614268127484 -0.0 -0.0 -0.0 -3.8041614268127484 -0.0; -1.3131162740760067 -1.3131162740760067 -0.0 -0.0 -0.0 -1.3131162740760067 -0.0; -0.18645252170591944 -0.18645252170591944 -0.0 -0.0 -0.0 -0.18645252170591944 -0.0; 1.4593378269316923 1.4593378269316923 0.0 0.0 0.0 1.4593378269316923 0.0; 8.572921389223637 8.572921389223637 0.0 0.0 0.0 8.572921389223637 0.0]
end

@testset "GLM:  with SqrtLink link - AnalyticWeights" begin
    model = glm(@formula(Days ~ Eth + Sex + Age + Lrn), quine, (), SqrtLink(), wts=quine)
    @test deviance(model) ≈ 626.6464732988984
    @test loglikelihood(model) ≈ -2005.5355831034462
    @test coef(model) ≈ 
    @test stderror(model) ≈ [0.42307979153860564, 0.286636744566765, 0.29612422536777805, 0.42042723748229144, 0.45565954626859695, 0.4766324296069839, 0.3235019638755972]
    @test aic(model) ≈ 4025.0711662068925
    @test bic(model) ≈ 4045.956412558851
    @test momentmatrix(model) ≈ [-1.4294351675636041 -0.0 -1.4294351675636041 -0.0 -0.0 -0.0 -1.4294351675636041; -1.5410055711037194 -0.0 -1.5410055711037194 -0.0 -0.0 -0.0 -1.5410055711037194; -1.3571249039047424 -0.0 -1.3571249039047424 -0.0 -0.0 -0.0 -1.3571249039047424; -1.7394058711709879 -0.0 -1.7394058711709879 -0.0 -0.0 -0.0 -0.0; -1.7394058711709879 -0.0 -1.7394058711709879 -0.0 -0.0 -0.0 -0.0; -1.229734152157926 -0.0 -1.229734152157926 -0.0 -0.0 -0.0 -0.0; -0.3742348640443611 -0.0 -0.3742348640443611 -0.0 -0.0 -0.0 -0.0; -0.09370480172054219 -0.0 -0.09370480172054219 -0.0 -0.0 -0.0 -0.0; -1.7293809063089827 -0.0 -1.7293809063089827 -1.7293809063089827 -0.0 -0.0 -1.7293809063089827; -1.7293809063089827 -0.0 -1.7293809063089827 -1.7293809063089827 -0.0 -0.0 -1.7293809063089827; -0.6748210571645206 -0.0 -0.6748210571645206 -0.6748210571645206 -0.0 -0.0 -0.6748210571645206; -1.5016227445218024 -0.0 -1.5016227445218024 -1.5016227445218024 -0.0 -0.0 -0.0; -0.058778966482651636 -0.0 -0.058778966482651636 -0.058778966482651636 -0.0 -0.0 -0.0; -1.6582836355486288 -0.0 -1.6582836355486288 -0.0 -1.6582836355486288 -0.0 -1.6582836355486288; 0.11341508381030255 0.0 0.11341508381030255 0.0 0.11341508381030255 0.0 0.11341508381030255; 2.4651888863431344 0.0 2.4651888863431344 0.0 2.4651888863431344 0.0 2.4651888863431344; 2.9517152556309942 0.0 2.9517152556309942 0.0 2.9517152556309942 0.0 2.9517152556309942; -1.2288386266845785 -0.0 -1.2288386266845785 -0.0 -1.2288386266845785 -0.0 -0.0; -1.0325293533841053 -0.0 -1.0325293533841053 -0.0 -1.0325293533841053 -0.0 -0.0; -1.0325293533841053 -0.0 -1.0325293533841053 -0.0 -1.0325293533841053 -0.0 -0.0; -0.9274622643228648 -0.0 -0.9274622643228648 -0.0 -0.9274622643228648 -0.0 -0.0; 2.212861910664014 0.0 2.212861910664014 0.0 2.212861910664014 0.0 0.0; 2.6862849076558937 0.0 2.6862849076558937 0.0 2.6862849076558937 0.0 0.0; 3.1694781034873523 0.0 3.1694781034873523 0.0 3.1694781034873523 0.0 0.0; -1.6534192741665588 -0.0 -1.6534192741665588 -0.0 -0.0 -1.6534192741665588 -0.0; -0.702446330017668 -0.0 -0.702446330017668 -0.0 -0.0 -0.702446330017668 -0.0; -0.702446330017668 -0.0 -0.702446330017668 -0.0 -0.0 -0.702446330017668 -0.0; -0.23123674216762394 -0.0 -0.23123674216762394 -0.0 -0.0 -0.23123674216762394 -0.0; 0.3871584524726257 0.0 0.3871584524726257 0.0 0.0 0.3871584524726257 0.0; 0.6036586921589513 0.0 0.6036586921589513 0.0 0.0 0.6036586921589513 0.0; 0.8246522973739006 0.0 0.8246522973739006 0.0 0.0 0.8246522973739006 0.0; -1.560441651521342 -0.0 -0.0 -0.0 -0.0 -0.0 -1.560441651521342; -1.7419685003857353 -0.0 -0.0 -0.0 -0.0 -0.0 -0.0; -1.4153955925789807 -0.0 -0.0 -0.0 -0.0 -0.0 -0.0; 0.23770439864218734 0.0 0.0 0.0 0.0 0.0 0.0; 3.853247675936175 0.0 0.0 0.0 0.0 0.0 0.0; -1.7692672149493731 -0.0 -0.0 -1.7692672149493731 -0.0 -0.0 -1.7692672149493731; -1.7282440188407218 -0.0 -0.0 -1.7282440188407218 -0.0 -0.0 -1.7282440188407218; -1.7282440188407218 -0.0 -0.0 -1.7282440188407218 -0.0 -0.0 -1.7282440188407218; -1.4769837741682987 -0.0 -0.0 -1.4769837741682987 -0.0 -0.0 -1.4769837741682987; -0.9582774689727417 -0.0 -0.0 -0.9582774689727417 -0.0 -0.0 -0.9582774689727417; 0.8052632685284861 0.0 0.0 0.8052632685284861 0.0 0.0 0.8052632685284861; 1.2077994352773953 0.0 0.0 1.2077994352773953 0.0 0.0 1.2077994352773953; 2.7042310768987665 0.0 0.0 2.7042310768987665 0.0 0.0 2.7042310768987665; 7.744950633464035 0.0 0.0 7.744950633464035 0.0 0.0 7.744950633464035; 7.999933021719232 0.0 0.0 7.999933021719232 0.0 0.0 7.999933021719232; -1.7392669278461907 -0.0 -0.0 -1.7392669278461907 -0.0 -0.0 -0.0; -1.7392669278461907 -0.0 -0.0 -1.7392669278461907 -0.0 -0.0 -0.0; -0.7262212443523531 -0.0 -0.0 -0.7262212443523531 -0.0 -0.0 -0.0; 0.7835691668207807 0.0 0.0 0.7835691668207807 0.0 0.0 0.0; 1.3489349925379315 0.0 0.0 1.3489349925379315 0.0 0.0 0.0; -1.6522100272913283 -0.0 -0.0 -0.0 -1.6522100272913283 -0.0 -1.6522100272913283; -1.4590418232851277 -0.0 -0.0 -0.0 -1.4590418232851277 -0.0 -1.4590418232851277; -1.4015111702500997 -0.0 -0.0 -0.0 -1.4015111702500997 -0.0 -1.4015111702500997; -0.9738202253475602 -0.0 -0.0 -0.0 -0.9738202253475602 -0.0 -0.9738202253475602; 1.8091899079230156 0.0 0.0 0.0 1.8091899079230156 0.0 1.8091899079230156; 1.9274245415701026 0.0 0.0 0.0 1.9274245415701026 0.0 1.9274245415701026; 3.399094699981504 0.0 0.0 0.0 3.399094699981504 0.0 3.399094699981504; 6.157344170373497 0.0 0.0 0.0 6.157344170373497 0.0 6.157344170373497; -1.5082203700488148 -0.0 -0.0 -0.0 -1.5082203700488148 -0.0 -0.0; -0.7518968254083281 -0.0 -0.0 -0.0 -0.0 -0.7518968254083281 -0.0; -1.403623374340758 -0.0 -0.0 -0.0 -0.0 -1.403623374340758 -0.0; -1.5307566638052945 -0.0 -0.0 -0.0 -0.0 -1.5307566638052945 -0.0; -1.6487615285777935 -0.0 -0.0 -0.0 -0.0 -1.6487615285777935 -0.0; -1.5960112869101046 -0.0 -0.0 -0.0 -0.0 -1.5960112869101046 -0.0; -1.3904968459197917 -0.0 -0.0 -0.0 -0.0 -1.3904968459197917 -0.0; -0.8618818687491527 -0.0 -0.0 -0.0 -0.0 -0.8618818687491527 -0.0; 0.6414580291618693 0.0 0.0 0.0 0.0 0.6414580291618693 0.0; 1.0942097094869556 0.0 0.0 0.0 0.0 1.0942097094869556 0.0; -1.7282583231217719 -1.7282583231217719 -1.7282583231217719 -0.0 -0.0 -0.0 -1.7282583231217719; -0.31744768418403196 -0.31744768418403196 -0.31744768418403196 -0.0 -0.0 -0.0 -0.31744768418403196; 11.375280355235768 11.375280355235768 11.375280355235768 0.0 0.0 0.0 11.375280355235768; -1.0256901959548927 -1.0256901959548927 -1.0256901959548927 -0.0 -0.0 -0.0 -0.0; -1.0256901959548927 -1.0256901959548927 -1.0256901959548927 -0.0 -0.0 -0.0 -0.0; -1.7598032161223125 -1.7598032161223125 -1.7598032161223125 -0.0 -0.0 -0.0 -0.0; -1.491030768800334 -1.491030768800334 -1.491030768800334 -0.0 -0.0 -0.0 -0.0; -0.7301769140610584 -0.7301769140610584 -0.7301769140610584 -0.0 -0.0 -0.0 -0.0; -0.5034045168716083 -0.5034045168716083 -0.5034045168716083 -0.0 -0.0 -0.0 -0.0; -1.113506915630734 -1.113506915630734 -1.113506915630734 -1.113506915630734 -0.0 -0.0 -1.113506915630734; -1.113506915630734 -1.113506915630734 -1.113506915630734 -1.113506915630734 -0.0 -0.0 -1.113506915630734; -1.6237007081122545 -1.6237007081122545 -1.6237007081122545 -1.6237007081122545 -0.0 -0.0 -1.6237007081122545; -1.6237007081122545 -1.6237007081122545 -1.6237007081122545 -1.6237007081122545 -0.0 -0.0 -1.6237007081122545; -1.6237007081122545 -1.6237007081122545 -1.6237007081122545 -1.6237007081122545 -0.0 -0.0 -1.6237007081122545; -0.07026189294137537 -0.07026189294137537 -0.07026189294137537 -0.07026189294137537 -0.0 -0.0 -0.07026189294137537; 2.0844355685058127 2.0844355685058127 2.0844355685058127 2.0844355685058127 0.0 0.0 2.0844355685058127; -1.7313903927438412 -1.7313903927438412 -1.7313903927438412 -1.7313903927438412 -0.0 -0.0 -0.0; -1.480745232754872 -1.480745232754872 -1.480745232754872 -1.480745232754872 -0.0 -0.0 -0.0; 0.21539031393949493 0.21539031393949493 0.21539031393949493 0.0 0.21539031393949493 0.0 0.21539031393949493; 1.6360787089859707 1.6360787089859707 1.6360787089859707 0.0 1.6360787089859707 0.0 1.6360787089859707; 2.7952193074887086 2.7952193074887086 2.7952193074887086 0.0 2.7952193074887086 0.0 2.7952193074887086; -1.448364418208364 -1.448364418208364 -1.448364418208364 -0.0 -1.448364418208364 -0.0 -0.0; -0.9833503482488964 -0.9833503482488964 -0.9833503482488964 -0.0 -0.9833503482488964 -0.0 -0.0; -1.5017276161539084 -1.5017276161539084 -1.5017276161539084 -0.0 -1.5017276161539084 -0.0 -0.0; -1.7640356839137032 -1.7640356839137032 -1.7640356839137032 -0.0 -1.7640356839137032 -0.0 -0.0; -1.5776069676233444 -1.5776069676233444 -1.5776069676233444 -0.0 -1.5776069676233444 -0.0 -0.0; 0.06361165131312438 0.06361165131312438 0.06361165131312438 0.0 0.06361165131312438 0.0 0.0; 2.8475608847598153 2.8475608847598153 2.8475608847598153 0.0 2.8475608847598153 0.0 0.0; -0.8892460264142052 -0.8892460264142052 -0.8892460264142052 -0.0 -0.0 -0.8892460264142052 -0.0; 1.7743695974457907 1.7743695974457907 1.7743695974457907 0.0 0.0 1.7743695974457907 0.0; -1.4305200814192562 -1.4305200814192562 -1.4305200814192562 -0.0 -0.0 -1.4305200814192562 -0.0; -0.9478929479399423 -0.9478929479399423 -0.9478929479399423 -0.0 -0.0 -0.9478929479399423 -0.0; 1.2024302930353608 1.2024302930353608 1.2024302930353608 0.0 0.0 1.2024302930353608 0.0; 4.02280289664674 4.02280289664674 4.02280289664674 0.0 0.0 4.02280289664674 0.0; 10.440933185941839 10.440933185941839 10.440933185941839 0.0 0.0 10.440933185941839 0.0; 1.262517093518885 1.262517093518885 0.0 0.0 0.0 0.0 1.262517093518885; -0.9176184029771589 -0.9176184029771589 -0.0 -0.0 -0.0 -0.0 -0.0; -0.6982138187318754 -0.6982138187318754 -0.0 -0.0 -0.0 -0.0 -0.0; 1.7133696015602422 1.7133696015602422 0.0 0.0 0.0 0.0 0.0; 5.976953806399672 5.976953806399672 0.0 0.0 0.0 0.0 0.0; -1.6123792319065735 -1.6123792319065735 -0.0 -1.6123792319065735 -0.0 -0.0 -1.6123792319065735; -1.1866621929181271 -1.1866621929181271 -0.0 -1.1866621929181271 -0.0 -0.0 -1.1866621929181271; -1.1194589330024307 -1.1194589330024307 -0.0 -1.1194589330024307 -0.0 -0.0 -1.1194589330024307; -1.6605118926433484 -1.6605118926433484 -0.0 -1.6605118926433484 -0.0 -0.0 -1.6605118926433484; -1.6123792319065735 -1.6123792319065735 -0.0 -1.6123792319065735 -0.0 -0.0 -1.6123792319065735; -1.6123792319065735 -1.6123792319065735 -0.0 -1.6123792319065735 -0.0 -0.0 -1.6123792319065735; -1.6123792319065735 -1.6123792319065735 -0.0 -1.6123792319065735 -0.0 -0.0 -1.6123792319065735; -1.6123792319065735 -1.6123792319065735 -0.0 -1.6123792319065735 -0.0 -0.0 -1.6123792319065735; -1.1866621929181271 -1.1866621929181271 -0.0 -1.1866621929181271 -0.0 -0.0 -1.1866621929181271; -0.016084003453250676 -0.016084003453250676 -0.0 -0.016084003453250676 -0.0 -0.0 -0.016084003453250676; 1.4107278812149031 1.4107278812149031 0.0 1.4107278812149031 0.0 0.0 1.4107278812149031; -1.1128985115655265 -1.1128985115655265 -0.0 -1.1128985115655265 -0.0 -0.0 -0.0; 3.7957001151581404 3.7957001151581404 0.0 3.7957001151581404 0.0 0.0 0.0; -0.7046958095802869 -0.7046958095802869 -0.0 -0.7046958095802869 -0.0 -0.0 -0.0; -0.7046958095802869 -0.7046958095802869 -0.0 -0.7046958095802869 -0.0 -0.0 -0.0; -0.2475403067755282 -0.2475403067755282 -0.0 -0.2475403067755282 -0.0 -0.0 -0.0; 14.054845699928913 14.054845699928913 0.0 14.054845699928913 0.0 0.0 0.0; -0.8850373634971601 -0.8850373634971601 -0.0 -0.0 -0.8850373634971601 -0.0 -0.8850373634971601; -1.7594068536637126 -1.7594068536637126 -0.0 -0.0 -1.7594068536637126 -0.0 -1.7594068536637126; -0.9681259531090506 -0.9681259531090506 -0.0 -0.0 -0.9681259531090506 -0.0 -0.9681259531090506; -1.5970364987524888 -1.5970364987524888 -0.0 -0.0 -1.5970364987524888 -0.0 -1.5970364987524888; -1.5970364987524888 -1.5970364987524888 -0.0 -0.0 -1.5970364987524888 -0.0 -1.5970364987524888; -1.7082890535667876 -1.7082890535667876 -0.0 -0.0 -1.7082890535667876 -0.0 -1.7082890535667876; -1.6168827210404924 -1.6168827210404924 -0.0 -0.0 -1.6168827210404924 -0.0 -1.6168827210404924; -1.4399676449006795 -1.4399676449006795 -0.0 -0.0 -1.4399676449006795 -0.0 -1.4399676449006795; -1.2202487676722908 -1.2202487676722908 -0.0 -0.0 -1.2202487676722908 -0.0 -1.2202487676722908; -1.5079358693315765 -1.5079358693315765 -0.0 -0.0 -1.5079358693315765 -0.0 -0.0; -1.3842064467607202 -1.3842064467607202 -0.0 -0.0 -0.0 -1.3842064467607202 -0.0; -1.5208922216041325 -1.5208922216041325 -0.0 -0.0 -0.0 -1.5208922216041325 -0.0; 0.3453894161447818 0.3453894161447818 0.0 0.0 0.0 0.3453894161447818 0.0; -1.717557999730545 -1.717557999730545 -0.0 -0.0 -0.0 -1.717557999730545 -0.0; -1.717557999730545 -1.717557999730545 -0.0 -0.0 -0.0 -1.717557999730545 -0.0; -1.76269912849327 -1.76269912849327 -0.0 -0.0 -0.0 -1.76269912849327 -0.0; -0.7863622513628796 -0.7863622513628796 -0.0 -0.0 -0.0 -0.7863622513628796 -0.0; -0.32795262618891574 -0.32795262618891574 -0.0 -0.0 -0.0 -0.32795262618891574 -0.0; 0.3453894161447818 0.3453894161447818 0.0 0.0 0.0 0.3453894161447818 0.0; 3.2758115948278728 3.2758115948278728 0.0 0.0 0.0 3.2758115948278728 0.0]
end

